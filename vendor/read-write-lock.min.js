var readWriteLock=function(e){"use strict";function t({maxActiveReader:e=1/0}={}){let t,n,r=0;const o={read:e=>c(e,!1),write:e=>c(e,!0),length:0};return o;function c(c,s){const i=function({fn:e,block:t=!1,prev:n,next:r,q:o=l(),q2:c=(e.length?l():null)}){return{fn:e,block:t,prev:n,next:r,q:o,q2:c}}({fn:c,block:s});return n?(n.next=i,i.prev=n,n=i,t||(t=n)):t=n=i,o.length++,function c(){const l=t;if(!l||l.block&&l.prev||l.prev&&l.prev.block||r>=e)return;l.block||r++;t=l.next;let s;try{s=l.fn(l.q2&&l.q2.resolve)}catch(e){return l.q.reject(e),void i()}l.q2&&l.q2.promise.then(u);if(s&&s.then){const e=s.then(l.q.resolve,l.q.reject);l.q2||e.then(i)}else if(l.q.resolve(s),!l.q2)return void i();c();function i(){u()}function u(e){l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),n===l&&(n=l.prev),l.block||r--,o.length--,e&&e(),c()}}(),i.q.promise}function l(){const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e}}return e.createLock=t,e.createLockPool=function(e){const n=new Map;return{read:(e,t)=>r(e,t,"read"),write:(e,t)=>r(e,t,"write"),locks:n};async function r(r,o,c){const l=[],s=[];for(const o of r){let r=n.get(o);r||(r=t(e),n.set(o,r));const i={lock:r,scope:o,relase:null};s.push(r[c](e=>{i.release=e})),l.push(i)}let i;await Promise.all(s);try{i=o(o.length&&u)}catch(e){throw u(),e}return i&&i.then?(o.length||i.then(u,u),await i):(o.length||u(),i);function u(){for(const e of l)e.release(()=>{e.lock.length||n.delete(e.scope)});l.length=0}}},e}({});
